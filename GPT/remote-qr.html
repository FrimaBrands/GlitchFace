<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scan to Start â€” Unknown Remote</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600&display=swap" rel="stylesheet">
  <style>
    :root { color-scheme: dark; }
    html, body { height: 100%; }
    body { margin: 0; display: grid; place-items: center; background: #0b0d11; color: #e5e7eb; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .wrap { text-align: center; }
    #q { background: #fff; padding: 10px; border-radius: 12px; display: inline-block; }
    .muted { color: #9aa0aa; margin-top: 16px; }
    .link-container { max-width: 80vw; margin: 16px auto 0; }
    .link { font-size: 12px; word-break: break-all; color: #9aa0aa; background: #1a1d23; padding: 8px; border-radius: 6px; }
    .copy-btn { margin-top: 12px; padding: 8px 16px; background: #374151; border: none; color: #e5e7eb; border-radius: 8px; cursor: pointer; }
    .error { color: #f87171; background: #2d1d22; padding: 16px; border-radius: 8px; border: 1px solid #5c2a32; }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="content">
      <div id="q"></div>
      <div class="muted">Scan this code to open the remote</div>
      <div class="link-container">
        <div id="small" class="link"></div>
        <button id="copyBtn" class="copy-btn">Copy Link</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    const content = document.getElementById('content');
    const targetUrl = new URLSearchParams(location.search).get('target');

    if (!targetUrl) {
      content.innerHTML = `<div class="error"><strong>Configuration Error:</strong> Missing target URL. This window cannot generate a QR code.</div>`;
    } else {
      // Generate QR Code
      new QRCode(document.getElementById('q'), {
        text: targetUrl,
        width: 360, height: 360, correctLevel: QRCode.CorrectLevel.M
      });
      document.getElementById('small').textContent = targetUrl;

      // "Copy Link" functionality
      const copyBtn = document.getElementById('copyBtn');
      copyBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(targetUrl)
          .then(() => {
            copyBtn.textContent = 'Copied!';
            setTimeout(() => { copyBtn.textContent = 'Copy Link'; }, 2000);
          })
          .catch(err => {
            copyBtn.textContent = 'Failed to copy';
            console.error('Failed to copy URL: ', err);
          });
      });
    }

    // Allow the host page to update the QR code without closing this window.
    window.addEventListener('message', (ev) => {
      const data = ev.data || {};
      if (data.type !== 'updateTarget' || !data.target) return;
      
      const holder = document.getElementById('q');
      const s = document.getElementById('small');
      if (!holder || !s) return;
      
      // Clear old QR code and create a new one
      holder.innerHTML = '';
      new QRCode(holder, {
        text: data.target,
        width: 360, height: 360, correctLevel: QRCode.CorrectLevel.M
      });
      
      s.textContent = data.target;
    });
  </script>
</body>
</html>
